# 简介

这是个windows系统的自动切换深浅色主题的 python3 脚本，鉴于微软一直没有实现这个自动切换深浅色主题的功能，所以我自己写了个脚本实现。

本方案全程使用Windows的定时任务功能实现，不存在后台常驻进程，所以不用担心资源占用浪费以及进程保活等问题。

# 实现方法

本脚本根据当前经纬度（可以自己编辑scheduler.py文件设置更准确的经纬度，我是按照广东这边的经纬度进行设置），使用网络API获取本地日出日落时间，并自动创建并更新两个windows的定时任务，在日出之前将系统主题设置为浅色，在日落之后将系统主题设置为深色。

同时，为了避免有的时候网络不好的情况，我将日出日落时间缓存在了本地，执行时直接从本地文件读取时间，避免因为网络问题导致切换失败。如果网络正常的情况，会尝试同步更新本地的日出日落时间文件。每次开机后的15分钟后更新一次定时任务以及本地的日出日落时间文件。

并且做了以下方案来避免因为‘主题切换时间过了但是电脑在休眠或者锁屏状态’的情况，导致没有成功切换的问题。

 - 每次登录时都会检查一次，如果时间已经过了，则直接切换主题。

 - 每次解锁试时都会检查一次，如果时间已经过了，则直接切换主题。

如果当前主题已经符合需求，则不会进行切换。

# 使用方法

1. 确保本机有 python3 环境，并安装`requests`模块。
2. 使用 python3 运行 `Start_Run.py` 文件，会自动创建所需要的定时任务。

自动创建的定时任务都放在 `AutoThemeSwitch` 文件夹下。可以 win + r 键入 `taskschd.msc` 打开定时任务管理器查看。

# 已知缺陷

由于微软 windows 的屎山代码的问题，切换主题时有概率会自动弹出设置面板，无法避免，稍微会有点影响体验。

当然我的脚本也做了切换成功后自动关闭设置面板的代码，所以影响也不大，切换的时候可能会看到个设置面板自动打开然后又自动关闭，大概会影响使用0.5秒左右。